<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title> Search Engine</title>
    <link rel="icon" href="./dog.ico" type="image/x-icon">
    <link rel="shortcut icon" href="./dog.ico" type="image/x-icon">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.js"></script>
    <link href="../static/grid.css" rel="stylesheet" type="text/css"/>
    <style>

        #personalPageBtn {
            text-decoration: none; /* 去掉下划线 */
            color: inherit; /* 使用其父元素的文字颜色 */
        }

        #personalPageBtn:hover {
            text-decoration: none; /* 确保鼠标悬停时也不会显示下划线 */
        }

        #title{
            color: white
        }

        .pagination {
            display: flex;
            justify-content: center;
            padding: 20px 0;
        }

        .pagination a {
            color: black;
            padding: 8px 16px;
            text-decoration: none;
            transition: background-color .3s;
        }

        .pagination a.active {
            background-color: #4CAF50;
            color: white;
        }

        .pagination a:hover:not(.active) {
            background-color: #ddd;
        }

        .col{
            color: black;
            height: 400px;
            overflow: hidden;
            background-color: #f0f0f0; /* 浅灰色 */
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); /* 边界阴影 */
            padding: 10px; /* 给内容添加一些内部间距 */
            margin-bottom: 20px; /* 为了给每个模块之间添加一些空间 */
        }

        #graph {
            border: 2px solid black;
            width: 45%;
            float: right;
            height: 30vh; /* 或您可以设置为其他值，例如300px */
            min-height: 300px; /* 设置一个合理的最小高度 */
        }

        .container {
            width: 100%;
        }


        a{
            color: blue;
        }

        input:focus{
            border-color: #66afe9;
            outline: 0;
            -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
            box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)
        }
    </style>

</head>


<body>
<!--进行搜索，返回    /load?query=   转到Mycontroller-->
<div style="display: flex; align-items: center; justify-content: space-between; color: white;">
    <!-- My Search Engine 文本区域 -->
    <h1 style="flex: 1; text-align: center;">
        <span style="color:#4286F3;">M</span><span style="color:#EB4537;">a</span><span style="color:#FAC230;">n</span><span style="color:#4286F3;">g</span><span style="color:#55AF7B;">o </span>
        <span style="color:#FAC230;">S</span><span style="color:#4286F3;">e</span><span style="color:#55AF7B;">a</span><span style="color:#EB4537;">r</span><span style="color:#4286F3;">c</span><span style="color:#EB4537;">h </span>
        <span style="color:#FAC230;">E</span><span style="color:#4286F3;">n</span><span style="color:#55AF7B;">g</span><span style="color:#EB4537;">i</span><span style="color:#4286F3;">n</span><span style="color:#EB4537;">e</span>
    </h1>
    <!-- 登录/注册区域 -->
    <div style="text-align: right; padding: 10px;">
        <button id="person">
            <a id="personalPageBtn" href="person.html" style="display: none;">Personal Page</a>
        </button>
        <button id="loginBtn">Login</button>
        <button id="registerBtn">Register</button>
    </div>
</div>


<form action="search" method="GET">
    <p style="color: white;text-align:center;!">

        <input style="width:430px; height:33px; box-sizing: border-box; padding: 1px 2px; border-radius:10px;" type="text" name="query" value="" />

        <input type="submit"/>
        <label>
            <input name="scope" type="radio" value="URL" />
            URL
        </label>
    </p>
</form>

<div style="width:100%; padding:10px;">

    <h3>Recommended for you:</h3>

    <div style="width:100%; padding:10px;">The Most Popular Paper:</div>
    <div th:each="detail: ${webDetails.values()}" style="width:18%; float:left; overflow:hidden; padding:10px; box-sizing:border-box;">
        <div style="width:100%; padding:10px;">
            <div style="width:100%; height:100px; padding:10px; color: #0a58ca; white-space:normal;">
                <span th:text="${detail.title}"></span>
            </div>
        </div>
    </div>

    <div style="clear:both;"></div>

    <div style="width:100%; padding:10px;">
        <div style="width:100%; padding:10px;">The Latest Popular Paper:</div>

        <div th:each="detail: ${latest5Papers}" style="width:18%; float:left; overflow:hidden; padding:10px; box-sizing:border-box;">
            <div style="width:100%; padding:10px;">
                <div style="width:100%; height:100px; padding:10px; color: #0a58ca; white-space:normal;">
                    <span th:text="${detail.title}"></span>
                </div>
            </div>
        </div>
    </div>

    <div style="clear:both;"></div>

    <div th:if="${userRecommendations != null and !userRecommendations.isEmpty()}" style="width:100%; padding:10px;">
        <div style="width:100%; padding:10px;">User-based Recommendations:</div>
        <div th:each="detail: ${userRecommendations.values()}" style="width:18%; float:left; overflow:hidden; padding:10px; box-sizing:border-box;">
            <div style="width:100%; padding:10px;">
                <div style="width:100%; height:100px; padding:10px; color: #0a58ca; white-space:normal;">
                    <span th:text="${detail.get('title')}"></span>
                </div>
            </div>
        </div>
    </div>

    <div style="clear:both;"></div>

    <div th:if="${!itemBasedRecommendations.isEmpty() and itemBasedRecommendations != null}" style="width:100%; padding:10px;">
        <div style="width:100%; padding:10px;">Item-based Recommendations:</div>
        <div th:each="detail: ${itemBasedRecommendations.values()}" style="width:18%; float:left; overflow:hidden; padding:10px; box-sizing:border-box;">
            <div style="width:100%; padding:10px;">
                <div style="width:100%; height:100px; padding:10px; color: #0a58ca; white-space:normal;">
                    <span th:text="${detail.get('title')}"></span>
                </div>
            </div>
        </div>
    </div>

</div>


<script>
    let loginBtn = document.getElementById("loginBtn");
    let registerBtn = document.getElementById("registerBtn");
    let personalPageBtn = document.getElementById("personalPageBtn");

    loginBtn.addEventListener("click", function() {
        if (loginBtn.innerText === "Login") {
            var userId = prompt("Please enter your User ID:");
            if (userId) {
                fetch("/existingUserIds")
                    .then(response => response.json())
                    .then(existingUserIds => {
                        if (existingUserIds.includes(userId)) {
                            loginUser(userId);
                        } else {
                            alert("No such User!!! Please input again!!!");  // 用户ID不存在时的消息
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching existing user IDs: ", error);
                    });
            }
        } else {
            logoutUser();  // 假设您已经有这个函数，用于处理注销操作
        }
    });

    registerBtn.addEventListener("click", function(){
        fetch("/existingUserIds")
            .then(response => response.json())
            .then(existingUserIds => {
                var newUserId = generateUserId(existingUserIds);
                localStorage.setItem("userId", newUserId);
                //loginUser(newUserId);
                alert("Your Id is: "+newUserId)
                window.location.href = "survey.html"; // 你的问卷调查页面路径
            })
            .catch(error => {
                console.error("Error fetching existing user IDs: ", error);
            });
    });

    function loginUser(userId) {
        loginBtn.innerText = "Logout";
        registerBtn.style.display = "none";
        personalPageBtn.style.display = "inline";
        person.style.display = "inline";
        // 将userId存储在localStorage以保持登录状态
        localStorage.setItem("userId", userId);
        document.cookie = "userId=" + userId + ";path=/;max-age=86400";
        window.location.reload();
    }

    function logoutUser() {
        loginBtn.innerText = "Login";
        registerBtn.style.display = "inline";
        personalPageBtn.style.display = "none";
        person.style.display = "none";
        // 清除localStorage中的userId
        localStorage.removeItem("userId");
        document.cookie = "userId=;path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT";
        window.location.reload();
    }

    function generateUserId(existingUserIds) {
        let newId = 0;
        while (existingUserIds.includes(newId.toString())) {
            newId++;
        }
        return newId;
    }






    // 检查是否已经登录
    window.onload = function() {
        var userId = localStorage.getItem("userId");
        if (userId) {
            //loginUser(userId);
            loginBtn.innerText = "Logout";
            registerBtn.style.display = "none";
            personalPageBtn.style.display = "inline";
            person.style.display = "inline";
        }
        else{
            person.style.display = "none";
        }
    };

</script>

</body>

</html>
